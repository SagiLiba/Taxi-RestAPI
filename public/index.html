<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=	, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="./style.css" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
    $(document).ready(function(){

        $("#searchForm").submit(function(){
            var lat = $("#lat").val();
            var lng = $("#lng").val();
            
            getDriversData(lat,lng);

            return false;
        });

        $(".mock").click(function(){
            var mock = $(this).attr("value");
            if ( mock == 1 ){
                setLocation(51,50);
            } else if ( mock == 2){
                setLocation(-80.2,25);
            } else if ( mock == 3){
                setLocation(80.5,40);
            }
        });

        function setLocation(lat,lng){
            $("#lat").val(lat);
            $("#lng").val(lng);
        }
        function getDriversData(lat,lng){
            
            $.getJSON("/api/drivers/?lng="+lng+"&lat="+lat, function( data ) {
                $("#availableUbers").html("");
                if ( data.length == 0){
                    var li = "<li style='text-align:center;'>No drivers available</li>";
                    $("#availableUbers").append(li);
                } else {
                    for ( var i = 0; i < data.length;i++){
                        var li = "<li>";
                            if (data[i].available){
                                li += "<span class='true'></span>";
                            } else {
                                li += "<span class='false'></span>";
                            }
                            li += "<span>"+data[i].name+"</span>";
                            li += "<span>"+data[i].rank+" <img src='star.png' height=11 width=11/></span>";
                            li += "<span class='dist'>"+Math.floor(data[i].dist.calculated / 1000)+" km</span>";
                            li += "</li>";
                        $("#availableUbers").append(li);
                    }
                }
            }).fail(function(){
                $("#availableUbers").html("");
                var li = "<li style='text-align:center;'>Invalid location</li>";
                $("#availableUbers").append(li);
            });
        }
    });
    </script>
    <title>Document</title>
</head>
<body>
    <h3 class="title">Taxi - Rest API</h3>
    <div id="mockdata" class="center">
        Mock Data:
        <span class="mock" value="1">1</span>
        <span class="mock" value="2">2</span>
        <span class="mock" value="3">3</span>
    </div>
    <div id="homepage">
        <h1>Call a driver in your area!</h1>
        <div id="ninjas"></div>
        <form id="searchForm">
            <div style="float: left;margin-left:15px;">
                Enter Latitude:
                <input type="text" id="lat" placeholder="latitude" required/>
            </div>
            <div style="float: right;margin-right:15px;">
                Enter Longitude:
                <input type="text" id="lng" placeholder="longitude" required/>
            </div>
            <input type="submit" value="Find an Uber" />
        </form>
        <ul id="availableUbers">
        </ul>
    </div>
</body>
</html>